(ns es.corygil.modulos 
 (:use
   es.corygil.factor-graph)
 (:use 
   es.corygil.factor-graph.bayes)
  (:import
   [es.corygil.factor_graph FNode VNode])
;CONSTRUÇÃO DO MODELO DO DOMÍNIO A PARTIR DE UMA REDE BAYESIANA FEITA EM CLOJURE

;bibliotecas utilizadas:
;factor graph e bayes net, feitos por Cory Giles

;A rede bayesiana é feita com base em um factor graph, e o modelo
;deve obedecer sua notação, que é da seguinte forma:
;A rede consiste em dois argumentos: 

;O primeiro argumento especifica o mapeamento de todos os nodos da rede.
;Se o nodo não possui pai, ele deve possuir uma probabilidade a priori.
;Caso o nodo tenha pai, ele deve apenas especificar a quantidade de estados que assume.

;O segundo argumento contém as tabelas de probabilidade condicional em um formato plano.
;Supondo [:B :A] [0.9 0.1 0.05 0.95], a tabela pode ser lida da seguinte forma: "A probabilidade
;de B dado A", onde P(B, A) é 0.9, P(B, ¬A) é 0.1, e assim por diante.

;A construção do modelo do domínio se baseia na ementa de Estruturas de Dados 1 
;do curso de sistemas de informação, Universidade Federal de Uberlândia.

;(use 'es.corygil.factor-graph)
;(use 'es.corygil.factor-graph.bayes)


(def introducao
    {	:ex1 [0.33 0.33 0.34]
		:ex2 [0.33 0.33 0.34]
		:ex3 [0.33 0.33 0.34]
		:ex4 [0.33 0.33 0.34]
		:ex5 [0.33 0.33 0.34]
		:ex6 [0.33 0.33 0.34]
		:ex7 [0.33 0.33 0.34]
		:ex8 [0.33 0.33 0.34]
		:ex9 [0.33 0.33 0.34]
		:ex10 [0.33 0.33 0.34]
	})
	
(def vetor
    {	:ex1 [0.33 0.33 0.34]
		:ex2 [0.33 0.33 0.34]
		:ex3 [0.33 0.33 0.34]
		:ex4 [0.33 0.33 0.34]
		:ex5 [0.33 0.33 0.34]
		:ex6 [0.33 0.33 0.34]
		:ex7 [0.33 0.33 0.34]
		:ex8 [0.33 0.33 0.34]
		:ex9 [0.33 0.33 0.34]
		:ex10 [0.33 0.33 0.34]
	})
		
(def matriz
    {	:ex1 [0.33 0.33 0.34]
		:ex2 [0.33 0.33 0.34]
		:ex3 [0.33 0.33 0.34]
		:ex4 [0.33 0.33 0.34]
		:ex5 [0.33 0.33 0.34]
		:ex6 [0.33 0.33 0.34]
		:ex7 [0.33 0.33 0.34]
		:ex8 [0.33 0.33 0.34]
		:ex9 [0.33 0.33 0.34]
		:ex10 [0.33 0.33 0.34]
	})
		
(def registro
    {	:ex1 [0.33 0.33 0.34]
		:ex2 [0.33 0.33 0.34]
		:ex3 [0.33 0.33 0.34]
		:ex4 [0.33 0.33 0.34]
		:ex5 [0.33 0.33 0.34]
		:ex6 [0.33 0.33 0.34]
		:ex7 [0.66 0.10 0.24]
		:ex8 [0.10 0.63 0.27]
		:ex9 [0.10 0.53 0.37]
		:ex10 [0.33 0.33 0.34]
	})

(def estruturas-dinamicas
    {	:ex1 [0.33 0.33 0.34]
		:ex2 [0.33 0.33 0.34]
		:ex3 [0.33 0.33 0.34]
		:ex4 [0.33 0.33 0.34]
		:ex5 [0.33 0.33 0.34]
		:ex6 [0.33 0.33 0.34]
		:ex7 [0.33 0.33 0.34]
		:ex8 [0.33 0.33 0.34]
		:ex9 [0.33 0.33 0.34]
		:ex10 [0.33 0.33 0.34]
	})
		
(def pilha
    {	:ex1 [0.33 0.33 0.34]
		:ex2 [0.33 0.33 0.34]
		:ex3 [0.33 0.33 0.34]
		:ex4 [0.33 0.33 0.34]
		:ex5 [0.33 0.33 0.34]
		:ex6 [0.33 0.33 0.34]
		:ex7 [0.33 0.33 0.34]
		:ex8 [0.33 0.33 0.34]
		:ex9 [0.33 0.33 0.34]
		:ex10 [0.33 0.33 0.34]
	})
		
(def fila
    {	:ex1 [0.33 0.33 0.34]
		:ex2 [0.33 0.33 0.34]
		:ex3 [0.33 0.33 0.34]
		:ex4 [0.33 0.33 0.34]
		:ex5 [0.33 0.33 0.34]
		:ex6 [0.33 0.33 0.34]
		:ex7 [0.33 0.33 0.34]
		:ex8 [0.33 0.33 0.34]
		:ex9 [0.33 0.33 0.34]
		:ex10 [0.33 0.33 0.34]
	})
		
(def compressao-dados
    {	:ex1 [0.33 0.33 0.34]
		:ex2 [0.33 0.33 0.34]
		:ex3 [0.33 0.33 0.34]
		:ex4 [0.33 0.33 0.34]
		:ex5 [0.33 0.33 0.34]
		:ex6 [0.33 0.33 0.34]
		:ex7 [0.33 0.33 0.34]
		:ex8 [0.33 0.33 0.34]
		:ex9 [0.33 0.33 0.34]
		:ex10 [0.33 0.33 0.34]
	})

(def dominio
	(bayes-net
	    { 
			:introducao [0.33 0.33 0.34]
			:vetor 3
			:matriz 3
			:registro 3
			:estruturas-dinamicas 3
			:pilha 3
			:fila 3
			:lista 3
			:compressao-dados 3
		}
	    {
	     [:vetor :introducao] [0.33 0.33 0.34 0.33 0.33 0.34 0.33 0.33 0.34]
	     [:matriz :vetor] [0.84 0.13 0.03 0.46 0.41 0.13 0.07 0.16 0.77]
	     [:registro :matriz] [0.84 0.13 0.03 0.46 0.41 0.13 0.07 0.16 0.77]
	     [:estruturas-dinamicas :registro] [0.84 0.13 0.03 0.46 0.41 0.13 0.07 0.16 0.77]
	     [:lista :estruturas-dinamicas] [0.33 0.33 0.34 0.33 0.33 0.34 0.33 0.33 0.34]
	     [:pilha :lista] [0.33 0.33 0.34 0.33 0.33 0.34 0.33 0.33 0.34]
	     [:fila :lista] [0.84 0.13 0.03 0.46 0.41 0.13 0.07 0.16 0.77]
	     [:compressao-dados :fila] [0.33 0.33 0.34 0.33 0.33 0.34 0.33 0.33 0.34]
	     ;[:compressao-dados :pilha :fila]
	     ;[0.5 0.42 0.08 0.2105 0.1053 0.6842 0.0 0.0 1.0 0.545 0.273 0.182 0.315 0.37 0.315 0.09 0.09 0.82 1.0 0.0 0.0 0.22 0.33 0.45 0.0 0.0 1.0]
		}))
		

;OPERACÕES:
(defn map-function-on-map-vals 
	"Uma funcao map modificada para maps"
    [m f]
  (reduce (fn [altered-map [k v]] (assoc altered-map k (f v))) {} m))

(defn second-map 
	"Pega o segundo item de uma sequencia." 
    [ m ]
   (nth m 1))

(defn calc-prob-conteudo [conteudo]
  "Calcula, dados os exercícios, as probabilidades bom, médio e ruim para cada conteúdo."
  (vector (/ (reduce + (vals (map-function-on-map-vals conteudo  first))) 10) ;a media de bom para todos os exercicios do conteudo
       (/ (reduce + (vals (map-function-on-map-vals conteudo  second-map))) 10) ;a media de médio para todos os exercicios do conteudo
       (/ (reduce + (vals (map-function-on-map-vals conteudo  last))) 10) ;a media de ruim para todos os exercicios do conteudo

))

;dominio baseado no artigo ambientes inteligentes de aprendizagem... nunes

;Podemos rodar a rede para todos os nós
(run-propagation dominio)
;Ou basear em uma evidência:
(run-propagation dominio {:introducao [1 0 0]})

(comment (def dominio2
	  (bayes-net
	    { 
		:estrutura-dados [0.20 0.38 0.42] ;vide artigo pág 88
	     	:vetor [0.29 0.30 0.41] ;vide artigo pág 87
	     	:alocacao-dinamica [0.33 0.33 0.34] ;nao forneceu, joguei 1/3 pra cada um
	     	:recursividade [0.33 0.33 0.34] ;nao forneceu, joguei 1/3 pra cada um
		:lista 3
		:pilha 3
		:fila 3
		:arvore 3
		:busca 3
		:ordenacao 3
	    }
	    {
		 [:lista :estrutura-dados] [0.33 0.33 0.34 0.33 0.33 0.34 0.33 0.33 0.34] ;nao fornecido
		 [:pilha :estrutura-dados] [0.33 0.33 0.34 0.33 0.33 0.34 0.33 0.33 0.34] ;nao fornecido
		 [:fila :estrutura-dados] [0.84 0.13 0.03 0.46 0.41 0.13 0.07 0.16 0.77]
		 [:arvore :estrutura-dados] [0.33 0.33 0.34 0.33 0.33 0.34 0.33 0.33 0.34] ;nao fornecido
		 [:ordenacao :estrutura-dados] [0.33 0.33 0.34 0.33 0.33 0.34 0.33 0.33 0.34] ;nao fornecido
		 [:busca :vetor :estrutura-dados]
		 [0.5 0.42 0.08 0.2105 0.1053 0.6842 0.0 0.0 1.0 0.545 0.273 0.182 0.315 0.37 0.315 0.09 0.09 0.82 1.0 0.0 0.0 0.22 0.33 0.45 0.0 0.0 1.0]
		})))



